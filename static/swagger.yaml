openapi: 3.0.0
info:
  title: PlayType Swagger
  description: PlayType Swagger api 예시
  version: 1.0.0

servers:
  - url: http://localhost:8000
    description: 로컬 서버

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

security:
  - BearerAuth: []

paths:
  /api/v1/community/{game_id}/reviews:
    post:
      summary: 리뷰 등록
      description: |
        특정 게임에 대한 새로운 리뷰를 등록합니다.
        - **권한**: 인증된 사용자만 가능 (Bearer Token 필요)
      tags:
        - Reviews
      parameters:
        - in: path
          name: game_id
          schema:
            type: integer
          required: true
          description: 게임 ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - content
                - rating
              properties:
                content:
                  type: string
                  description: 리뷰 내용
                rating:
                  type: integer
                  description: 평점 (1~5 사이의 정수)
                  minimum: 1
                  maximum: 5
              example:
                content: "생각해보니 스토리는 별로네요."
                rating: 3
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                    description: 생성된 리뷰 ID
                  message:
                    type: string
                example:
                  id: 101
                  message: "리뷰가 등록되었습니다."
        '400':
          description: Bad Request (유효성 검사 실패)
          content:
            application/json:
              schema:
                type: object
                properties:
                  error_detail:
                    type: string
                    description: 에러 요약 메시지
                  errors:
                    type: object
                    description: 필드별 상세 에러 내역
                    additionalProperties:
                      type: array
                      items:
                        type: string
              example:
                error_detail: "이 필드는 필수 항목입니다."
                errors:
                  rating: ["별점은 1에서 5 사이의 정수여야 합니다."]
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                type: object
                properties:
                  error_detail:
                    type: string
              example:
                error_detail: "로그인이 필요한 서비스입니다."
        '404':
          description: Not Found (존재하지 않는 게임)
          content:
            application/json:
              schema:
                type: object
                properties:
                  error_detail:
                    type: string

    get:
      summary: 리뷰 목록 조회
      description: |
        특정 게임의 리뷰 목록을 최신순으로 조회합니다.
        - **권한**: 누구나 가능 (AllowAny)
      tags:
        - Reviews
      parameters:
        - in: path
          name: game_id
          schema:
            type: integer
          required: true
          description: 게임 ID
        - in: query
          name: page
          schema:
            type: integer
            default: 1
          description: 페이지 번호 (기본값 1)
        - in: query
          name: size
          schema:
            type: integer
            default: 10
          description: 페이지 당 개수 (기본값 10, 최대 50)
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  count:
                    type: integer
                    description: 전체 리뷰 개수
                  next:
                    type: string
                    nullable: true
                    format: uri
                    description: 다음 페이지 URL
                  previous:
                    type: string
                    nullable: true
                    format: uri
                    description: 이전 페이지 URL
                  results:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                          description: 리뷰 ID
                        author:
                          type: object
                          description: 작성자 정보
                          properties:
                            id:
                              type: integer
                              description: 유저 ID
                            nickname:
                              type: string
                              description: 유저 닉네임
                            profile_img_url:
                              type: string
                              nullable: true
                              format: uri
                              description: 프로필 이미지 URL
                        content:
                          type: string
                          description: 리뷰 내용
                        rating:
                          type: integer
                          description: 별점 (1~5)
                        like_count:
                          type: integer
                          description: 좋아요 수
                        created_at:
                          type: string
                          format: date-time
                          description: 작성일시
                example:
                  count: 1
                  next: null
                  previous: null
                  results:
                    - id: 1
                      author:
                        id: 10
                        nickname: "감자"
                        profile_img_url: "https://example.com/profile.jpg"
                      content: "정말 재미있는 게임입니다!"
                      rating: 5
                      like_count: 12
                      created_at: "2025-01-15T14:30:00+09:00"
  /api/v1/community/reviews/{review_id}:
    put:
      summary: 리뷰 수정
      tags:
        - Reviews
      parameters:
        - in: path
          name: review_id
          schema:
            type: integer
          required: true
          description: 리뷰 ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                content:
                  type: string
                rating:
                  type: integer
              example:
                content: "생각해보니 스토리는 별로네요."
                rating: 3
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                  updated_at:
                    type: string
                    format: date-time
                example:
                  id: 1
                  updated_at: "2025-01-15T14:30:00+09:00"
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                type: object
                properties:
                  error_detail:
                    type: string
              example:
                error_detail: "이 필드는 필수 항목입니다."
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                type: object
                properties:
                  error_detail:
                    type: string
              example:
                error_detail: "작성자가 일치하지 않습니다."

    delete:
      summary: 리뷰 삭제
      tags:
        - Reviews
      parameters:
        - in: path
          name: review_id
          schema:
            type: integer
          required: true
          description: 리뷰 ID
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                example:
                  message: "리뷰가 삭제되었습니다."
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                type: object
                properties:
                  error_detail:
                    type: string
              example:
                error_detail: "삭제 권한이 없습니다."

  /api/v1/community/reviews/{review_id}/comments:
    post:
      summary: 댓글 작성
      tags:
        - Comments
      parameters:
        - in: path
          name: review_id
          schema:
            type: integer
          required: true
          description: 리뷰 ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                content:
                  type: string
              example:
                content: "공감합니다"
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                  message:
                    type: string
                example:
                  id: 5
                  message: "댓글등록성공"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                type: object
                properties:
                  error_detail:
                    type: string
              example:
                error_detail: "자격 인증 데이터가 제공되지 않았습니다."

    get:
      summary: 리뷰 상세 조회 (댓글 포함)
      tags:
        - Reviews
      parameters:
        - in: path
          name: review_id
          schema:
            type: integer
          required: true
          description: 리뷰 ID
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                    description: 리뷰 ID
                  author:
                    type: object
                    description: 리뷰 작성자 정보
                    properties:
                      id:
                        type: integer
                      nickname:
                        type: string
                      profile_img_url:
                        type: string
                        nullable: true
                        format: uri
                  content:
                    type: string
                    description: 리뷰 내용
                  rating:
                    type: integer
                    description: 별점
                  view_count:
                    type: integer
                    description: 조회수
                  like_count:
                    type: integer
                    description: 좋아요 수
                  created_at:
                    type: string
                    format: date-time
                    description: 작성일시
                  comments:
                    type: array
                    description: 해당 리뷰에 달린 댓글 목록
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                          description: 댓글 ID
                        author:
                          type: object
                          description: 댓글 작성자 정보
                          properties:
                            id:
                              type: integer
                            nickname:
                              type: string
                            profile_img_url:
                              type: string
                              nullable: true
                              format: uri
                        content:
                          type: string
                          description: 댓글 내용
                        created_at:
                          type: string
                          format: date-time
                example:
                  id: 100
                  author:
                    id: 10
                    nickname: "겜돌이"
                    profile_image_url: "https://example.com/profile.jpg"
                  content: "이 게임 정말 강추합니다! 스토리랑 그래픽이 미쳤어요."
                  rating: 5
                  view_count: 120
                  like_count: 45
                  created_at: "2025-01-15T10:00:00+09:00"
                  comments:
                    - id: 1
                      author:
                        id: 25
                        nickname: "지나가던유저"
                        profile_image_url: null
                      content: "저도 동의합니다. 특히 엔딩이 인상 깊었어요."
                      created_at: "2025-01-15T10:30:00+09:00"
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                type: object
                properties:
                  error_detail:
                    type: string
                  code:
                    type: string
                example:
                  error_detail: "유효하지 않은 조회 요청입니다."


  /api/v1/community/reviews/comments/{comment_id}:
    put:
      summary: 댓글 수정
      tags:
        - Comments
      parameters:
        - in: path
          name: comment_id
          schema:
            type: integer
          required: true
          description: 댓글 ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                content:
                  type: string
              example:
                content: "오타가 있어서 수정합니다"
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                  updated_at:
                    type: string
                    format: date-time
                example:
                  id: 1
                  updated_at: "2025-01-15T14:30:00+09:00"
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                type: object
                properties:
                  error_detail:
                    type: string
              example:
                error_detail: "작성자가 일치하지 않습니다."

    delete:
      summary: 댓글 삭제
      tags:
        - Comments
      parameters:
        - in: path
          name: comment_id
          schema:
            type: integer
          required: true
          description: 댓글 ID
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                example:
                  message: "댓글이 삭제되었습니다."
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                type: object
                properties:
                  error_detail:
                    type: string
              example:
                error_detail: "삭제 권한이 없습니다."

  /api/v1/community/reviews/{review_id}/like:
      post:
        summary: 리뷰 좋아요 등록
        description: |
          특정 리뷰에 좋아요를 등록합니다.
        tags:
          - Likes
        parameters:
          - in: path
            name: review_id
            schema:
              type: integer
            required: true
            description: 리뷰 ID
        responses:
          '201':
            description: Created
            content:
              application/json:
                schema:
                  type: object
                  properties:
                    is_liked:
                      type: boolean
                      description: 현재 유저의 좋아요 여부 (항상 true)
                    like_count:
                      type: integer
                      description: 갱신된 총 좋아요 수
                  example:
                    is_liked: true
                    like_count: 13
          '401':
            description: Unauthorized
            content:
              application/json:
                schema:
                  type: object
                  properties:
                    error_detail:
                      type: string
                example:
                  error_detail: "로그인이 필요한 서비스입니다."
          '404':
            description: Not Found (존재하지 않는 리뷰)
            content:
              application/json:
                schema:
                  type: object
                  properties:
                    error_detail:
                      type: string
                example:
                  error_detail: "존재하지 않는 리뷰입니다."

      delete:
        summary: 리뷰 좋아요 취소
        description: |
          특정 리뷰의 좋아요를 취소합니다.
        tags:
          - Likes
        parameters:
          - in: path
            name: review_id
            schema:
              type: integer
            required: true
            description: 리뷰 ID
        responses:
          '200':
            description: OK
            content:
              application/json:
                schema:
                  type: object
                  properties:
                    is_liked:
                      type: boolean
                      description: 현재 유저의 좋아요 여부 (항상 false)
                    like_count:
                      type: integer
                      description: 갱신된 총 좋아요 수
                  example:
                    is_liked: false
                    like_count: 12
          '401':
            description: Unauthorized
            content:
              application/json:
                schema:
                  type: object
                  properties:
                    error_detail:
                      type: string
                example:
                  error_detail: "로그인이 필요한 서비스입니다."
          '404':
            description: Not Found (존재하지 않는 리뷰)
            content:
              application/json:
                schema:
                  type: object
                  properties:
                    error_detail:
                      type: string

  /api/v1/community/{game_id}/reviews/summary:
    post:
      summary: AI 리뷰 요약 생성
      tags:
        - AI Summary
      parameters:
        - in: path
          name: game_id
          schema:
            type: integer
          required: true
          description: 게임 ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                game_id:
                  type: integer
              example:
                game_id: 105
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                  game_id:
                    type: integer
                  text:
                    type: string
                  created_at:
                    type: string
                    format: date-time
                example:
                  id: 12
                  game_id: 105
                  text: "그래픽이 매우 훌륭합니다.\n 타격감이 좋으나 스토리가 아쉽습니다."
                  created_at: "2026-01-07 15:30:00"
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                type: object
                properties:
                  error_detail:
                    type: string
              example:
                error_detail: "부적절 콘텐츠 감지"
        '408':
          description: Request Timeout
          content:
            application/json:
              schema:
                type: object
                properties:
                  error_detail:
                    type: string
              example:
                error_detail: "15초 이상 응답 없음"
        '500':
          description: Server Error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error_detail:
                    type: string
              example:
                error_detail: "AI 모델 연동 실패"